CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit

Public idEvent As Integer

Private Sub Bezeichnungsfeld172_Click()


End Sub

Private Sub checkboxesDeactivate()
    Dim rsVeranstaltung As Recordset
    Set rsVeranstaltung = CurrentDb.OpenRecordset("Select * from tblVeranstaltung", dbOpenDynaset)

    Do While Not rsVeranstaltung.EOF
        'rsVeranstaltung("inTagesplan") = True
        'End With
        'rsVeranstaltung.Update("inTagesplan") = True
        With rsVeranstaltung
            
            .Edit
            !inTagesplan = False
            .Update
        End With
        rsVeranstaltung.MoveNext
    Loop



End Sub

Private Sub chkBox_Click()




End Sub


Private Sub chkBox_GotFocus()

Dim db As DAO.Database
   ' Dim lngVeransaltungID As Long
    Set db = CurrentDb


If Me!chkBox = True Then ' If checked.
' hier prozedur was gemacht werden soll wenn aktiviert

db.Execute "DELETE FROM tblVeranstaltungTagesplan WHERE frkTagesplan = " & idEvent & " AND frkVeranstaltung = " & idVeranstaltung, dbFailOnError

Me.idVeranstaltung.SetFocus
Me!chkBox = False

Else
 ' hier prozedur was gemacht werden soll wenn deaktiviert
 db.Execute "INSERT INTO tblVeranstaltungTagesplan(frkTagesplan, frkVeranstaltung) VALUES(" & idEvent & ", " & idVeranstaltung & ")", dbFailOnError

 
Me.idVeranstaltung.SetFocus
Me!chkBox = True
 End If

End Sub

Private Sub Detailbereich_Click()





    ''''''''''''''MsgBox "erggege" & idVeranstaltung
    'Dim parentForm As String
    'parentForm = Me.Parent.Name
    'Dim rs As Object
    '    Set rs = Forms(parentForm).Form.Recordset.Clone
    '    rs.FindFirst "[idVeranstaltung] = " & Me!idVeranstaltung
    '    If Not rs.EOF Then Forms(parentForm).Form.Bookmark = rs.Bookmark


End Sub

Private Sub Form_Current()
    
'makeCheckbox

End Sub

Private Sub Form_Load()
'makeCheckbox
End Sub

Private Sub headerVeranstaltungAnfang_Click()

    DoCmd.SetOrderBy "dateVeranstaltungAnfang ASC"
    '
End Sub

Private Sub headerVeranstaltung_Click()

    DoCmd.SetOrderBy "txtVeranstaltungName ASC"


End Sub

Private Sub txtSearch_BeforeUpdate(Cancel As Integer)
    Dim parentForm As String

    parentForm = Me.Parent.Name

    Dim strFilter As String
    If Len(Me!txtSearch) > 0 Then
        strFilter = "txtVeranstaltungName LIKE '" _
            & Me!txtSearch & "'"
        Me!parentForm.Form.Filter = strFilter
        Me!parentForm.Form.FilterOn = True
    Else
        Me.Form.Filter = ""
    End If
End Sub

Private Sub txtSearch_Click()
    Me.AllowEdits = True
End Sub






Public Sub makeCheckbox(ID As Integer)

Dim TagesID As Integer
idEvent = ID

'TagesID = Me.

Me.AllowAdditions = False

    Dim parentForm As String

    parentForm = Me.Parent.Name

    Debug.Print (parentForm)
    'me.Parent.
    Dim db As DAO.Database
    Dim rsTagesplan As Object
    Dim tagesplanID As Integer
    Dim rsTagesplanJunction As Recordset
    Dim rsVeranstaltung As Recordset

    Set db = CurrentDb

    Set rsTagesplan = Forms(parentForm).Form.Recordset.Clone
    
    'MsgBox "ID Parent " & rsTagesplan("idTagesplan")
    
    'tagesplanID = Forms(parentForm).CurrentRecord
    'tagesplanID = rsTagesplan("idTagesplan")
    tagesplanID = ID

    Set rsTagesplanJunction = _
        db.OpenRecordset("SELECT * FROM qryVeranstaltung_aktiv WHERE frkTagesplan = " _
        & tagesplanID, dbOpenDynaset)
    Set rsVeranstaltung = _
        db.OpenRecordset("Select * from tblVeranstaltung", dbOpenDynaset)
        
    ' Erst mal alle checkboxen deaktivieren
    
    checkboxesDeactivate
        
    Do While Not rsVeranstaltung.EOF
        
        If rsVeranstaltung!idVeranstaltung = rsTagesplanJunction!frkVeranstaltung Then
        
        With rsVeranstaltung
                .Edit
                !inTagesplan = True
                .Update
    
                End With
        
        End If
        
        Do While Not rsTagesplanJunction.EOF
        
        If rsVeranstaltung!idVeranstaltung = rsTagesplanJunction!frkVeranstaltung Then
        
        With rsVeranstaltung
                .Edit
                !inTagesplan = True
                .Update
    
                End With
        
        End If
        rsTagesplanJunction.MoveNext
   
        
        Loop
        
        rsTagesplanJunction.MoveFirst
        
        
        'Debug.Print rsTagesplanJunction!frkVeranstaltung
        
        
        
'        If rsVeranstaltung!idVeranstaltung = rsTagesplanJunction!frkVeranstaltung Then
'
'            Debug.Print "Treffer"
'
'
'            rsTagesplanJunction.MoveNext
'
'        End If
         rsVeranstaltung.MoveNext
    Loop
            
            
    '            If rsVeranstaltung!idVeranstaltung = rsTagesplanJunction!frkVeranstaltung Then
    '
    '            With rsVeranstaltung
    '            .Edit
    '            !inTagesplan = True
    '            .Update
    '
    '            End With
    '            rsTagesplanJunction.MoveNext
    '            End If
            
            
            
        
        
        
        
        
        
    Set Me.Recordset = rsVeranstaltung
        
        
        



End Sub
